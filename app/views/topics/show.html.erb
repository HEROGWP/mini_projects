<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v2.8";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="fb-like" data-href="<%=request.original_url%>" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
<%= render(:partial => "who_likes") %>

<div style="clear: both;" id="clear"></div>
<h1>
	<%= @topic.title %>
	
	<% if @favorite.present? %>
		<%= link_to "", favorite_path(:topic_id => params[:id]), :method => :delete, :class => "btn btn-danger btn-lg glyphicon glyphicon-star-empty " %>
	<% else %>
		<%= link_to "", favorite_path(:topic_id => params[:id]), :method => :post, :class => "btn btn-primary btn-lg glyphicon glyphicon-star " %>
	<% end %>
	<%= render(:partial => "like_or_unlike") %>
</h1> 
<p><%= @topic.content %></p>
<% if @comment.errors.any? %>
    <div class="alert alert-warning" role="alert">
      <% @comment.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </div>
<% end %>



<%= form_for @comment, :url => @url, method: @action do |t|%>
	<div class="form-group">
		<%= t.label :status, "Status:" %>
		<%= t.select :status, [["Pubilshed", "published"], ["Draft", "draft"]]  %>	
	</div>
	<div class="form-group">
		<%= t.label :content, "Content:" %>
		<%= t.text_area :content, :class => "form-control" %>
	</div>

<!-- 	<%= hidden_field_tag :page, params[:page] %> -->
	<%= t.submit @submit_name, :class => "btn btn-primary" %>
<% end %>

<hr style="height:2px;border:none;color:#333;background-color:#333;" />

<table class="table table-hover">
	<tr>
		<th>Comment</th>
		<th>Update_at</th>
		<th>
			<%= link_to "", topic_path(@topic, :status => :published), :class => "btn btn-success glyphicon glyphicon-eye-open"%>
			<%= link_to "", topic_path(@topic, :status => :draft), :class => "btn btn-warning glyphicon glyphicon-eye-close" %></th>
	</tr>
	<% @comments.each do |c| %>
			<tr>
				<td><%= truncate(c.content, :length => 100) %></td>
				<td><%= "Updated by " %> 
				<% if c.user.profile %>
					<%= link_to "#{c.user.email}", profile_path(:id => c.user.profile) %>
				<% else %>
					<%= c.user.email %>
				<% end %>
				<%= " at " + time_ago_in_words(c.updated_at) + " ago" %>
				</td>
				<td>
					<% if current_user == c.user || current_user.admin? %>
						<%= link_to "", topic_path(@topic, :comment_id => c, :page => params[:page], :status => params[:status]), :class => "btn btn-primary glyphicon glyphicon-pencil" %>
						<%= link_to "", topic_comment_path(@topic,c, :page => params[:page], :status => params[:status]), :method => :delete, :class => "btn btn-danger glyphicon glyphicon-trash" %>
					<% end %>
				</td>
			</tr>
	
	<% end %>
</table>

<div style="float: left;"><%= paginate @comments %></div>
<div style="float: right; margin-top: 15px; "><%= link_to "",topics_path, :class => "btn btn-lg btn-info glyphicon glyphicon-share-alt"%></div>
