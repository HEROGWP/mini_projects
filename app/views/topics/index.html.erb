
<% if @topic.errors.any? %>
    <div class="alert alert-warning" role="alert">
      <% @topic.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </div>
<% end %>


<%= form_for @topic do |t|%>
	<div class="form-group">
		<%= t.label :title, "Title:" %>
		<%= t.text_field :title, :class => "form-control" %>
	</div>
	<div class="form-group">
		<%= t.label :category, "Category:" %>
		<%= t.collection_check_boxes(:category_ids, Category.all, :id, :name)%>
	</div>
	<div class="form-group">
		<%= t.label :status, "Status:" %>
		<%= t.select :status, [["Pubilshed", "published"], ["Draft", "draft"]]  %>	
	</div>
	<div class="form-group">
		<%= t.label :content, "Content:" %>
		<%= t.text_area :content, :class => "form-control" %>
	</div>

	<%= t.submit @submit_name, :class => "btn btn-primary" %>
<% end %>

<hr style="height:2px;border:none;color:#333;background-color:#333;" />

<% @categories.each do |c| %>
	<%= link_to c.name, topics_path(:category => c.name, :order => params[:order], :status => params[:status] ), :class => "btn btn-info" %>
<% end %>

<hr style="height:2px;border:none;color:#333;background-color:#333;" />
<table class="table table-hover">
	<tr>
		<th><%= link_to "Title", topics_path(:order => :updated_at, :category => params[:category], :status => params[:status])%></th>
		<th>Content</th>
		<th>Owner</th>
		<th><%= link_to "Comments", topics_path(:order => :comments, :category => params[:category], :status => params[:status])%></th>
		<th><%= link_to "views", topics_path(:order => :views, :category => params[:category], :status => params[:status])%></th>
		<th><%= link_to "latest_comment", topics_path(:order => :latest_comment, :category => params[:category], :status => params[:status])%></th>
		<th>
			<%= link_to "", topics_path(:order => params[:order], :category => params[:category], :status => :published), :class => "btn btn-success glyphicon glyphicon-eye-open"%>
			<%= link_to "", topics_path(:order => params[:order], :category => params[:category], :status => :draft), :class => "btn btn-warning glyphicon glyphicon-eye-close" %>
		</th>
	</tr>
	<% @topics.each do |t| %>
		<tr>
			<td><%= link_to "#{truncate(t.title, :length => 40)}", topic_path(t) %></td>
			<td><%= truncate(t.content, :length => 10) %></td>
			<% if t.user.profile %>
				<td><%= link_to "#{t.user.email}", profile_path(:id => t.user.profile) %></td>
			<% else %>
				<td><%= t.user.email %></td>
			<% end %>
			<td><%= t.comments.size %></td>
			<td><%= t.views %></td>
			<td><%= t.comments.last.try(:updated_at)%></td>
			<td>
				<% if current_user == t.user || current_user.admin? %>
					<%= link_to "", topics_path( :id =>  t, :page => params[:page], :order => params[:order], :category => params[:category], :status => params[:status]), :class => "btn btn-primary glyphicon glyphicon-pencil" %>
					<%= link_to "", topic_path(t, :page => params[:page], :order => params[:order], :category => params[:category], :status => params[:status]), :method => :delete, :class => "btn btn-danger glyphicon glyphicon-trash" %>
				<% end %>
			</td>
		</tr>
	<% end %>
</table>
<%= paginate @topics %>
